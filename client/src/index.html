<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="assets/css/bootstrap-theme.min.css" rel="stylesheet"/>
        <link href="assets/css/game.css" rel="stylesheet"/>
        <script src="assets/js/jquery.min.js" type="text/javascript"></script>
        <script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
        <script type="text/javascript" charset="utf-8" src="socket.io/socket.io.js"></script>
        <script type="text/javascript" charset="utf-8">
            var rooms = [];
            var socket = io.connect("http://localhost");
            var playerName = null;

            function buildPlayerStatusLines(players){
                $("#my-name").text(playerName);
                //need to find the opponent name, could be in either spot.
                $("#opponent-name").text(players[players[0].name === playerName? 1 : 0].name);
            };

            socket.on("joined-room", function(data){
                if(data.room.status === "waiting") {
                    $("#waiting-modal").modal({
                        keyboard: false,
                        backdrop: "static"
                    });
                }
                else{
                    $("#waiting-modal").modal("hide");
                    $("#login-panel").hide();
                    //build the game screen
                    buildPlayerStatusLines(data.room.players);
                    $("#game-container").fadeIn();
                }
            });

            socket.on("room-message", function(data){
                $("#roomMessages").append("<p>" + data + "</p>");
            });

            $(function(){
                //event listeners
                $("#signin-button").on("click", function(){
                    playerName = $("#username").val();
                    socket.emit("join-room", {
                        username: $("#username").val(),
                        room: $("#room-name").val()
                    });
                });

                $("#load-deck").on("click", function(){
                    $("#upload-modal").modal({
                        keyboard: false
                    });
                });

                $("#deck-list-file").on("change", function(){
                    var files = this.files; // FileList object

                    // Loop through the FileList and render image files as thumbnails.
                    for (var i = 0, f; f = files[i]; i++) {
                        var reader = new FileReader();
                        reader.onload = function(e){
                            //result of the readAsText, parse it out and make that my deck.
                            socket.
                            console.log(e.target.result);
                        };

                        // Read in the image file as a data URL.
                        reader.readAsText(f);
                    }
                })
            });
        </script>
        <title>VS System Online</title>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6 col-md-offset-3" id="login-panel">
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            <h3>Please sign in</h3>
                        </div>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="username">User name</label>
                                <input id="username" type="text" class="form-control" name="username" placeholder="User name" autofocus required />
                            </div>
                            <div class="form-group">
                                <label for="room-name">Room name</label>
                                <input id="room-name" type="text" class="form-control" name="room" placeholder="Room name" required />
                            </div>
                        </div>
                        <div class="panel-footer">
                            <p><button id="signin-button" type="submit" class="btn btn-default center-block">Submit</button></p>
                        </div>
                    </div>
                </div>

                <div id="game-container">
                    <div class="col-xs-12 player-status-line" id="player1-status-line">
                        <div class="player-info-container">
                            <div class="player-avatar" id="my-avatar"></div>
                            <div class="player-name" id="my-name"></div>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Actions <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a href="#" id="load-deck">Load Deck</a></li>
                                <li><a href="#">Roll Die</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xs-12 player-status-line" id="player2-status-line">
                        <div class="player-info-container">
                            <div class="player-avatar" id="opponent-avatar"></div>
                            <div class="player-name" id="opponent-name"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="waiting-modal" tabindex="-1" role="dialog" aria-labelledby="waiting-modal-label">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="modal-title">Waiting for another player to join</h4>
                    </div>
                    <div class="modal-body">
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="upload-modal" tabindex="-1" role="dialog" aria-labelledby="upload-modal-label">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Waiting for another player to join</h4>
                    </div>
                    <div class="modal-body">
                        <input type="file" id="deck-list-file"/>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
